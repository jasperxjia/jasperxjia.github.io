<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Accessible AR Interaction for VIP (vision impaired people)</title>
    <link rel="stylesheet" href="">

    <!-- Import Aframe and AR.js -->
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script> 
    <script src="./aframe-ar.js"></script>

    <!-- Import Haptic API -->
    <script type="text/javascript" src="//raw.githubusercontent.com/shantanubala/haptics.js/master/haptics.js"></script>

</head>


<!-- AR scene Render based on AFRAME onclick="speechSynthesis.speak(new SpeechSynthesisUtterance('find objects'))" -->
<body style='margin: 0; overflow: hidden;'>
  <a-scene  
    cursor="fuse:false; rayOrigin: mouse" embedded arjs="sourceType: webcam; trackingMethod: best;" vr-mode-ui="false" >

    <!--Asset Management System (not rendered unless called)-->
    <a-assets>
      <a-asset-item id="asset1" src="./assets/lowpoly_pin/scene.gltf"></a-asset-item>
      <a-asset-item id="asset2" src="./assets/lowpoly_pin/scene.gltf"></a-asset-item>
    </a-assets>
    
    <!--Add a Marker where assets load onto-->
    <a-marker markerevents clickable-model preset='hiro'>
      <a-entity  gltf-model="#asset1" scale="0.5 0.5 0.5" position="0 0 0" rotation="-90 0 0" id="model" alt="This is a pin!"></a-entity>

      <a-entity geometry="primitive: plane;" material="opacity: 0">
        <a-text value="placeholder" visible="false" id="text-box" position="-0.425 0.293 -0.531" rotation="-84.347 54.042 -51.893"></a-text>
      </a-entity>
    </a-marker>

    <a-marker markerevents clickable-model type="pattern" url='./assets/cloud.patt'>
      <a-entity  gltf-model="#asset2" scale="0.5 0.5 0.5" position="0 0 0" rotation="-90 0 0" id="model" alt="This is a cloud!"></a-entity>

      <a-entity geometry="primitive: plane;" material="opacity: 0">
        <a-text value="placeholder" visible="false" id="text-box" position="-0.425 0.293 -0.531" rotation="-84.347 54.042 -51.893"></a-text>
      </a-entity>
    </a-marker>

    <!--Add a Camera-->
    <a-entity camera></a-entity>
  </a-scene>



  <!-- Script for VIP interaction -->
  <script>
        
//Give this conponenet to marker to show alerts found and lost events
    AFRAME.registerComponent('markerevents', {
        init: function () {
          var marker = this.el;

          marker.addEventListener('markerFound', function() {
            var markerId = marker.id;
            //alert('markerfound'); // For testing
            speechSynthesis.speak(new SpeechSynthesisUtterance('A R object found'));
            window.navigator.vibrate([200, 100, 200]);
            
          });

          marker.addEventListener('markerLost', function() {
            var markerId = marker.id;
            //alert('markerLost');// For testing
            speechSynthesis.speak(new SpeechSynthesisUtterance('A R object lost')); 
            window.navigator.vibrate(200);          
          });
        }
      });


//Give this conponenet to clickable objects 

    AFRAME.registerComponent('clickable-model', {
      init: function () {

        const model = this.el.getElementById('model');
        const readmodel = model.getAttribute('alt');

        const textbox = document.getElementById('text-box');
        var text = textbox.setAttribute('value',readmodel);   
        const readtext = textbox.getAttribute('value');

      model.addEventListener('click', function (event) {
          if(textbox.object3D.visible == false && event.detail.cursorEl){
            textbox.object3D.visible = true;
            speechSynthesis.speak(new SpeechSynthesisUtterance(readmodel)); 
            window.navigator.vibrate(200);}

          else{
            textbox.object3D.visible = false;
            speechSynthesis.speak(new SpeechSynthesisUtterance(readmodel)); 
            window.navigator.vibrate(200);
          
          } });

          textbox.addEventListener('click', function (event) {
            speechSynthesis.speak(new SpeechSynthesisUtterance(readtext)); 
            window.navigator.vibrate(200);
          } );    

            /*  Use this line if no text needed
  
      model.addEventListener('click', function (event) {
          speechSynthesis.speak(new SpeechSynthesisUtterance(readmodel)); 
            window.navigator.vibrate(200);

        });*/

      }
    });
 </script>

</body>
</html>
