<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Accessible AR Interaction for VIP (vision impaired people)</title>
    <link rel="stylesheet" href="">

    <!-- Import Aframe and AR.js -->
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script> 
    <script src="./scripts/aframe-ar.js"></script>

    <!-- Import Haptic API -->
    <script type="text/javascript" src="//raw.githubusercontent.com/shantanubala/haptics.js/master/haptics.js"></script>

    <!-- Import Swipe-Events API -->
    <script type="text/javascript" src="./scripts/swiped-events.min.js"></script>

</head>


<!-- AR scene Render based on AFRAME onclick="speechSynthesis.speak(new SpeechSynthesisUtterance('find objects'))" -->
<body style='margin: 0; overflow: hidden;'>
  <a-scene  
    cursor="fuse:false; rayOrigin: mouse" embedded arjs="sourceType: webcam; trackingMethod: best;" vr-mode-ui="false" >

    <!--Asset Management System (not rendered unless called)-->
    <a-assets>
      <a-asset-item id="asset1" src="./assets/models/lowpoly_pin/scene.gltf"></a-asset-item>
      <a-asset-item id="asset2" src="./assets/models/cloud.gltf"></a-asset-item>
      <a-asset-item id="asset3" src="./assets/models/window.gltf"></a-asset-item>
    </a-assets>
    
    <!--Add a Marker where assets load onto-->
    <a-marker markerevents  preset='hiro' alt="A pin!">
      <a-entity gltf-model="#asset1" scale="0.8 0.8 0.8" position="0 0 0" rotation="-90 0 0"></a-entity>
    </a-marker>

    
    <!--a-entity geometry="primitive: plane;" material="opacity: 0">
      <a-text value="placeholder" visible="false" id="text-box" position="-0.425 0.293 -0.531" rotation="-84.347 54.042 -51.893"></a-text>
    </a-entity-->

    <!--Add a Camera-->
    <a-entity camera rotation-reader></a-entity>
  </a-scene>



  <!-- Script for VIP interaction -->
  <script>
//Give this conponenet to marker to show alerts found and lost events
    AFRAME.registerComponent('markerevents', {
        init: function () {
          var marker = this.el;
          var readmarker = marker.getAttribute('alt');
          var scene = document.querySelector('a-scene');
          
          scene.addEventListener('click', function (event) {
            speechSynthesis.cancel();
            speechSynthesis.speak(new SpeechSynthesisUtterance()); 
            window.navigator.vibrate(200);
        });


          marker.addEventListener('markerFound', function() {
            var markerId = marker.id;

            //alert('markerfound'); // For testing
            speechSynthesis.cancel();
            speechSynthesis.speak(new SpeechSynthesisUtterance(readmarker.concat('found')));
            speechSynthesis.speak(new SpeechSynthesisUtterance('Double Click to interact'));
            window.navigator.vibrate([200, 100, 200]);

            scene.addEventListener('click', function (event) {
            speechSynthesis.cancel();
            speechSynthesis.speak(new SpeechSynthesisUtterance(readmarker)); 
            window.navigator.vibrate(200);});
              
          });



          marker.addEventListener('markerLost', function() {
            var markerId = marker.id;
            //alert('markerLost');// For testing
            speechSynthesis.cancel();
            speechSynthesis.speak(new SpeechSynthesisUtterance('Nothing here')); //show left/right relative position through rotation-reader 
            window.navigator.vibrate(200);   

            scene.addEventListener('click', function (event) {
            speechSynthesis.cancel();
            speechSynthesis.speak(new SpeechSynthesisUtterance('Look Around')); 
            window.navigator.vibrate(200);});
            
          });
        }
      });


      AFRAME.registerComponent('rotation-reader', {
  /**
   * We use IIFE (immediately-invoked function expression) to only allocate one
   * vector or euler and not re-create on every tick to save memory.
   */
  tick: (function () {
    var position = new THREE.Vector3();
    var quaternion = new THREE.Quaternion();

    return function () {
      this.el.object3D.getWorldPosition(position);
      this.el.object3D.getWorldQuaternion(quaternion);
      // position and rotation now contain vector and quaternion in world space.
    };
  })
});

//Give this conponenet to clickable objects 

  /*  AFRAME.registerComponent('clickable-model', {
      init: function () {

        let model = this.el;
        let readmodel = model.getAttribute('alt');

                   //Use this line if no text needed
  
        model.addEventListener('click', function (event) {
          speechSynthesis.speak(new SpeechSynthesisUtterance(readmodel)); 
            window.navigator.vibrate(200);


            /* enable rest when text needed

        const textbox = document.getElementById('text-box');
        var text = textbox.setAttribute('value',readmodel);   
        const readtext = textbox.getAttribute('value');

        model.addEventListener('click', function (event) {
          if(textbox.object3D.visible == false && event.detail.cursorEl){
            textbox.object3D.visible = true;
            speechSynthesis.speak(new SpeechSynthesisUtterance(readmodel)); 
            window.navigator.vibrate(200);}

          else{
            textbox.object3D.visible = false;
            speechSynthesis.speak(new SpeechSynthesisUtterance(readmodel)); 
            window.navigator.vibrate(200);
          
          } });

          textbox.addEventListener('click', function (event) {
            speechSynthesis.speak(new SpeechSynthesisUtterance(readmodel)); 
            window.navigator.vibrate(200);
          } );  
           

        });

      }
    }); */ 
 </script>

</body>
</html>
